<?xml version="1.0" encoding="iso-8859-1"?>
<!--
     The FreeBSD Documentation Project

     $FreeBSD$
-->
<sect1 xml:id="releng-building">
  <title>Building &os; Installation Media</title>

  <para>This section describes the general procedures producing &os;
    development snapshots and releases.</para>

  <sect2 xml:id="releng-build-scripts">
    <title>Release Build Scripts</title>

    <para>This section describes the build scripts used by &team.re;
      to produce development snapshots and releases.</para>

    <sect3 xml:id="releng-build-scripts-single">
      <title>The <filename>release.sh</filename> Script</title>

      <para>Prior to &os;&nbsp;9.0-RELEASE,
	<filename>src/release/Makefile</filename> was updated to
	support &man.bsdinstall.8;, and the
	<filename>src/release/generate-release.sh</filename> script
	was introduced as a wrapper to automate invoking the
	&man.release.7; targets.</para>

      <para>Prior to &os;&nbsp;9.2-RELEASE,
	<filename>src/release/release.sh</filename> was introduced,
	which heavily based on
	<filename>src/release/generate-release.sh</filename> included
	support to specify configuration files to override various
	options and environment variables.  Support for configuration
	files provided support for cross building each architecture
	for a release by specifying a separate configuration file for
	each invocation.</para>

      <para>As a brief example of using
	<filename>src/release/release.sh</filename> to build a single
	release in <filename
	  class="directory">/scratch</filename>:</para>

      <screen>&prompt.root; <userinput>/bin/sh /usr/src/release/release.sh</userinput></screen>

      <para>As a brief example of using
	<filename>src/release/release.sh</filename> to build a single,
	cross-built release using a different target directory, create
	a custom <filename>release.conf</filename> containing:</para>

      <programlisting># release.sh configuration for powerpc/powerpc64
CHROOTDIR="/scratch-powerpc64"
TARGET="powerpc"
TARGET_ARCH="powerpc64"
KERNEL="GENERIC64"</programlisting>

      <para>Then invoke <filename>src/release/release.sh</filename>
	as:</para>

      <screen>&prompt.root; <userinput>/bin/sh /usr/src/release/release.sh -c <replaceable>&dollar;HOME/release.conf</replaceable></userinput></screen>

      <para>See &man.release.7; and
	<filename>src/release/release.conf.sample</filename> for more
	details and example usage.</para>
    </sect3>

    <sect3 xml:id="releng-build-scripts-multiple">
      <title>The <filename>thermite.sh</filename> Wrapper
	Script</title>

      <para>In order to make cross building the full set of
	architectures supported on a given branch faster, easier, and
	reduce human error factors, a wrapper script around
	<filename>src/release/release.sh</filename> was written to
	iterate through the various combinations of architectures and
	invoke <filename>src/release/release.sh</filename> using
	a configuration file specific to that architecture.</para>

      <para>The wrapper script is called
	<filename>thermite.sh</filename>, which is available in the
	&os; Subversion repository at
	<literal>svn://svn.freebsd.org/user/gjb/thermite/</literal>,
	in addition to configuration files used to build
	&branch.head; and &branch.stablex; development
	snapshots.</para>

      <para>Using <filename>thermite.sh</filename> is covered in <xref
	  linkend="releng-build-snapshot"/> and <xref
	  linkend="releng-build-release"/>.</para>
    </sect3>
  </sect2>

  <sect2 xml:id="releng-build-snapshot">
    <title>Building &os; Development Snapshots</title>

    <para>&nbsp;</para>
  </sect2>

  <sect2 xml:id="releng-build-release">
    <title>Building &os; Releases</title>

    <para>&nbsp;</para>
  </sect2>
</sect1>
